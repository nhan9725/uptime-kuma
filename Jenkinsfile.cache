pipeline {
    agent {
  kubernetes {
    yamlFile 'k8s/KubernetesPod.yaml' 
}
  }
    environment {
        YARN_CACHE_FOLDER = "/home/jenkins/agent/yarn-cache"
    }

    stages {
//
        stage ('Check for existence of index.html') {
            steps {
                script {
                    if (fileExists('/home/jenkins/.cache/yarn/dependencies-9e80c5051af62a08fc2b6cc2b5f90e02.tar')) {
                    echo "File home/jenkins/.cache/yarn/dependencies-9e80c5051af62a08fc2b6cc2b5f90e02.tar found!"
                }
                else {
                echo "No file found"
            }
        }
    }
}

        stage('Install Dependencies') {
            steps {
                script {
                    // Set the Yarn cache folder environment variable
                    sh 'yarn config set cache-folder $YARN_CACHE_FOLDER'

                    // Check if we need to install dependencies
                    def cacheHit = fileExists('node_modules')
                    if (!cacheHit) {
                        // Install dependencies
                        sh 'yarn install'

                        // Create the tar file for caching
                        sh "tar -cf ${env.CACHE_FILE} node_modules .yarn_cache"
                    }
                }
            }
        }


    }

    post {
        always {
            // Clean up stashed files
            cleanWs()
        }
    }
}
